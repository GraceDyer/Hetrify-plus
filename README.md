# README

## Running Environment

We recommend using Docker for setting up the running environment. The provided Docker image contains all necessary tools, libraries, and experimental data, along with the Hetrify tool.

### Using Docker

To use the provided Docker environment, follow these steps:

1. **Pull the Docker image**:

    ```sh
    docker pull anonymous535/hetrify-plus:latest
    ```

2. **Run the Docker container**:

    ```sh
    docker run -it --name hetrify_container -u root anonymous535/hetrify-plus:latest /bin/bash
    cd ~
    ```

The Docker container includes all necessary dependencies and tools, as well as the experimental data and Hetrify tool located in the home directory.

### Manual Setup (if not using Docker)

If you prefer to set up the environment manually on Ubuntu 22.04 or a compatible Linux distribution, the following tools and libraries are required:

1. **Python 3.10**: Including `venv` and `dev` packages.
2. **CBMC 5.95**: A Bounded Model Checker for C and C++ programs.
3. **RISC-V GNU Toolchain**: For compiling and running RISC-V programs.
4. **libxml2**: A library for parsing XML documents.
5. **libelf1**: A library to handle ELF (Executable and Linkable Format) files.
6. **Python packages**: `tqdm` for progress bar and `pyelftools` for working with ELF files.
7. **Rust (rustc)**: Rust compiler with support for RISC-V architecture, enabling safe and performant cross-compilation.

To set up the environment manually, follow these steps:
```sh
# Update and install basic dependencies
sudo apt-get update
sudo apt-get install -y build-essential curl wget tar python3.10 python3.10-venv python3.10-dev bash-completion libxml2 libelf-dev python3-pip

# Install Python packages tqdm and pyelftools
pip3 install tqdm pyelftools

# Install CBMC 5.95
wget https://github.com/diffblue/cbmc/releases/download/cbmc-5.95.1/ubuntu-22.04-cbmc-5.95.1-Linux.deb
dpkg -i ubuntu-22.04-cbmc-5.95.1-Linux.deb

# Install RISC-V GNU Toolchain
wget https://github.com/riscv-collab/riscv-gnu-toolchain/releases/download/2023.01.31/riscv64-elf-ubuntu-22.04-nightly-2023.01.31-nightly.tar.gz
tar -xvf riscv64-elf-ubuntu-22.04-nightly-2023.01.31-nightly.tar.gz
sudo mv riscv64-unknown-elf /opt/riscv
echo 'export PATH=/opt/riscv/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```



## Directory Structure

- **EX1**: Contains datasets and results for Experiment 1 in the paper, including the assembly code to be verified, the C code generated by Hetrify, and the result files.
- **EX2**: Contains datasets and results for Experiment 2 in the paper.
- **EX3**: Contains datasets and results for comparison experiments between Hetrify, IDA Pro, and Ghidra.
- **Hetrify**: The verification transformation tool designed in our ICSE paper.
- **Hetrify+**: The verification transformation tool designed in this paper.
- **ae**: Auxiliary analysis tool for binary files. Hetrify invokes the `ae` tool during its operation.
## Supported Functions of Hetrify+

Hetrify and Hetrify+ support the transformation of the following types of code:
- Binary programs (.elf)
- RISC-V assembly programs (.s)
- C programs (.c)
- C mixed with assembly programs (.c)
- RISC-V static library code (.a)
- Rust programs (.rs)
## Basic Usage of Hetrify+

Assume you want to verify the program `./bAnd1.s`. You can run Hetrify with the following command:

```sh
./Hetrify+ ./bAnd1.s
```

This command will generate a C program named `bAnd1_gen.c` in the `./` directory. You can then use CBMC to verify the correctness of this program.

```sh
cbmc ./bAnd1_gen.c --unwind 20
```
## Additional Functions of Hetrify+

To view the additional functions and usage of Hetrify, use the following command:

```sh
./Hetrify+
```

## Experiment 1

All files for Experiment 1 are stored in the `EX1` folder, including the assembly code to be verified, which is located in the `ASM` folder, the C code generated by Hetrify from the assembly code, stored in the `Hetrify/F`, `Hetrify/T` folders, and the C code generated by Hetrify+ in the `Hetrify+/F` and `Hetrify+/T` folders, along with the result files. You can use the `solve.py` script to verify the converted C programs.



### Example Usage

Assume you want to verify all files in the `Hetriy+/F` folder with a loop unwind value of 50. You can run the following command:

```sh
cd EX1
python3 solve.py Hetrify+/F  H+F50.csv 50 3000
```

After all programs are verified, a file named `H+F50.csv` will be generated, recording the corresponding verification results.

## Experiment 2

All files for Experiment 2 are stored in the `EX2` folder. This experiment involves heterogeneous programs with missing critical function source code, including static libraries with missing functions, the C code generated by Hetrify from these static libraries, and the result files. You can use the `solve.py` script to verify the converted C programs, which are located in the `Hetrify/F`, `Hetrify/T`, `Hetrify+/F`, and `Hetrify+/T` folders.


### Example Usage

Assume you want to verify all files in the `Hetrify+/T` folder with a loop unwind value of 100. You can run the following command:

```sh
cd EX2
python3 solve.py Hetrify+/T  H+T100.csv 100 3000
```

After all programs are verified, a file named `H+T100.csv` will be generated, recording the corresponding verification results.


## Experiment 3

All files for Additional Experiment 1 are stored in the `EX3` folder, including datasets and results for comparison experiments between Hetrify, IDA Pro, and Ghidra. The `solve.py` script is used to compare the analysis results across these tools, with input files located in the `Ghidra`, `Hetrify` and `Hetrify+` subfolders.

### Example Usage

Assume you want to compare all files in the `Ghidra` subfolder with the IDA Pro and Ghidra results and store the output in `GT200.csv`. You can run the following command:

```sh
cd EX3
python3 solve.py Ghidra/T  GT200.csv 200 3000
```

After running the script, a file named `GT200.csv` will be generated, containing the comparison results for each tool.
